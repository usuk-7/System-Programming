## 📖 12장 파일 시스템과 파일 입출력

### 📌 강의 개요
이 강의에서는 파일 시스템과 파일 입출력에 대한 내용을 다루며, 주요 학습 내용은 다음과 같습니다:
* 파일 시스템
* 파일 상태 정보와 i-노드
* 디렉터리
* 링크의 구현
* 파일 입출력

---

### ☑️ 12.1 파일 시스템

#### 파일 시스템 보기

* **사용법**: `$ df 파일시스템*` 명령은 파일 시스템에 대한 디스크 사용 정보를 보여준다.
* **사용 예**:
    ```bash
    $ df
    Filesystem     1K-blocks      Used Available Use% Mounted on
    udev             1479264         0   1479264   0% /dev
    tmpfs            302400      1684    300716   1% /run
    /dev/sda5      204856328  14082764 180297788   8% /
    /dev/sda1         523248         4    523244   1% /boot
    ```
* **`df` 출력 설명**:
    * `/`: 루트 파일 시스템이며 현재 8% 사용 중이다.
    * `/dev`: 각종 디바이스 파일들을 위한 파일 시스템이다.
    * `/boot`: 리눅스 커널의 메모리 이미지와 부팅을 위한 파일 시스템이다.

#### 디스크 사용량 보기

* **사용법**: `$ du [-s] 파일명*` 명령은 파일 혹은 디렉터리의 사용량을 보여준다. 파일을 명시하지 않으면 현재 디렉터리 내의 모든 파일들의 사용 공간을 보여준다.
* **사용 예**:
    ```bash
    $ du
    208 ./사진
    4 ./.local/share/nautilus/scripts
    8 ./.local/share/nautilus
    144 ./.local/share/gvfs-metadata
    4 ./.local/share/icc
    $ du -s
    22164
    ```

#### 파일 시스템 구조

* **파일 시스템 구성**: 부트 블록, 슈퍼 블록, i-리스트, 데이터 블록으로 구성된다.
    * **부트 블록(Boot block)**: 파일 시스템 시작부에 위치하며 보통 첫 번째 섹터를 차지하고 부트스트랩 코드가 저장된다.
    * **슈퍼 블록(Super block)**: 전체 파일 시스템에 대한 정보를 저장하며, 총 블록 수, 사용 가능한 i-노드 개수, 블록 비트 맵, 블록의 크기 등을 포함한다.
    * **i-리스트(i-list)**: 각 파일을 나타내는 모든 i-노드들의 리스트이며, 한 블록은 약 40개 정도의 i-노드를 포함한다.
    * **데이터 블록(Data block)**: 파일의 내용(데이터)을 저장하기 위한 블록들이다.

---

### ☑️ 12.2 파일 상태 정보와 i-노드

#### 파일 상태(file status)

* **파일 상태**: 파일에 대한 모든 정보(블록 수, 파일 타입, 접근권한, 링크 수, 파일 소유자의 사용자 ID, 그룹 ID, 파일 크기, 최종 수정 시간)를 포함한다.
* **`ls -l` 출력 형식 분석**:
    ```bash
    $ ls -l cs1.txt
    4 -rw-rw-r-- 1 chang chang 2088 10월 23 13:37 cs1.txt
    ```
    출력은 블록수, 접근권한, 링크수, 사용자ID, 그룹ID, 파일 크기, 최종 수정 시간, 파일이름, 파일 타입을 보여준다.

#### `stat` 명령어

* **사용법**: `$ stat [옵션] 파일` 명령은 파일의 자세한 상태 정보를 출력한다.
* **예**:
    ```bash
    $ stat cs1.txt
    File: cs1.txt
    Size: 2088 Blocks: 8 IO Block: 4096 일반 파일
    Device: 803h/2051d Inode: 1196554 Links: 1
    Access: (0600/-rw-rw-r--) Uid: (1000/chang) Gid: (1000/chang)
    Access: 2021-10-04 01:28:01.726822341 -0700
    Modify: 2021-10-04 01:28:01.726822341 -0700
    Change: 2021-10-04 01:28:01.726822341 -0700
    Birth: 2021-10-04 01:28:01.726822341 -0700
    ```

#### i-노드

* 한 파일은 하나의 i-노드를 갖는다. `ls -i cs1.txt` 명령으로 i-노드 번호를 확인할 수 있다.
* i-노드는 파일에 대한 모든 정보(블록 수, 파일 종류, 접근권한, 하드 링크 수, 소유자 및 그룹, 파일 크기, 최종 접근 시간, 최종 수정 시간, 데이터 블록 주소)를 가지고 있다.

#### i-노드와 블록 포인터

* **블록 포인터**: 파일의 내용을 저장하기 위해 할당된 데이터 블록의 주소를 가리킨다.
* **i-노드 내의 블록 포인터**: 직접 블록 포인터 12개, 간접 블록 포인터 1개, 이중 간접 블록 포인터 1개로 구성된다.

---

### ☑️ 12.3 디렉터리

#### 디렉터리 구현

* 디렉터리 내에는 파일 이름과 그 파일의 i-노드 번호로 구성된 디렉터리 엔트리가 저장된다.
* 디렉터리도 파일 시스템 내에서 일종의 파일로 구현되며, 다른 파일처럼 하나의 i-노드로 표현된다.

---

### ☑️ 12.4 링크의 구현

#### 링크

* **링크**: 기존 파일에 대한 또 하나의 새로운 이름이다.
* **종류**: 하드 링크와 심볼릭 링크가 있다.
* **사용법**:
    * `$ ln [-s] 파일1 파일2`: 파일1에 대한 새로운 이름(링크)으로 파일2를 만들어 준다. `-s` 옵션은 심볼릭 링크를 생성한다.
    * `$ ln [-s] 파일1 디렉터리`: 파일1에 대한 링크를 지정된 디렉터리에 같은 이름으로 만들어 준다.

#### 하드 링크(hard link)

* **하드 링크**: 기존 파일에 대한 새로운 이름이며, 실제로 기존 파일을 대표하는 i-노드를 가리켜 구현된다.
* **예**: `ln hello.txt hi.txt` 명령 후 `ls -l` 및 `ls -i`를 통해 두 파일이 동일한 i-노드를 공유함을 확인할 수 있다.

#### 심볼릭 링크(symbolic link)

* **심볼릭 링크**: 다른 파일을 가리키고 있는 별도의 파일로, 실제 파일의 경로명을 저장하고 있는 일종의 특수 파일이다. 이 경로명이 다른 파일에 대한 간접적인 포인터 역할을 한다.
* **예**: `ln -s hello.txt hi.txt` 명령 시 `hi.txt`가 `hello.txt`를 가리키는 심볼릭 링크로 생성됨을 `ls -l`로 확인할 수 있다. 또한 `/usr/bin/gcc`에 대한 `cc`라는 심볼릭 링크 예시가 제시된다.

---

### ☑️ 12.5 C 파일 입출력

#### 시스템 호출(system call)

* **시스템 호출**: 유닉스 커널에 서비스를 요청하기 위한 프로그래밍 인터페이스이다. 응용 프로그램은 시스템 호출을 통해서 유닉스 커널에 서비스를 요청한다.

#### 파일

* C 프로그램에서 파일이 필요한 이유는 변수에 저장된 정보들이 실행이 끝나면 모두 사라지기 때문에, 정보를 영속적으로 저장하기 위해서 파일에 저장해야 한다.
* 유닉스 파일은 모든 데이터를 연속된 바이트 형태로 저장한다.

#### C 언어의 파일 종류

* **텍스트 파일(text file)**: 사람들이 읽을 수 있는 문자들을 저장하고 있는 파일이다. "한 줄의 끝" 표현이 C 내부 방식으로 변환된다.
* **이진 파일(binary file)**: 모든 데이터가 있는 그대로 바이트의 연속으로 저장되며, 메모리에 저장된 변수 값 형태 그대로 파일에 저장할 수 있다.

#### 파일 입출력

* **C 언어의 파일 입출력 과정**:
    1.  파일 열기: `fopen()` 함수 사용
    2.  파일 입출력: 다양한 파일 입출력 함수 사용
    3.  파일 닫기: `fclose()` 함수 사용

#### 파일 열기

* 파일을 사용하기 위해서는 반드시 먼저 파일 열기(`fopen`)를 해야 하며, 파일 열기를 하면 `FILE` 구조체에 대한 포인터가 리턴된다. `FILE` 포인터는 열린 파일을 지정한다.
* **함수 `fopen()`**: `FILE *fopen(const char *filename, const char *mode);` 함수는 파일 열기를 하며, 열린 파일을 나타내는 `FILE` 포인터를 반환하고 오류가 발생하면 `NULL`을 반환한다.

#### `fopen()`: 텍스트 파일 열기

* **모드별 의미**:
    * `"r"` (읽기 전용): 파일이 없으면 `NULL` 반환, 있으면 정상 동작.
    * `"w"` (쓰기 전용): 파일이 없으면 새로 생성, 있으면 기존 내용 삭제.
    * `"a"` (추가 쓰기): 파일이 없으면 새로 생성, 있으면 기존 내용 뒤에 추가.
    * `"r+"` (읽기와 쓰기): 파일이 없으면 `NULL` 반환, 있으면 정상 동작.
    * `"w+"` (읽기와 쓰기): 파일이 없으면 새로 생성, 있으면 기존 내용 삭제.
    * `"a+"` (추가를 위한 읽기와 쓰기): 파일이 없으면 새로 생성, 있으면 기존 내용 뒤에 추가.

#### 스트림과 `FILE` 구조체

* **스트림**: 파일이 열리면 스트림(stream)이라고 한다.
* **`FILE` 구조체**: `stdio.h`에 정의되어 있으며, 열린 파일의 현재 상태를 나타내는 필드 변수들과 파일 입출력에 사용되는 버퍼 관련 변수들을 포함한다.

#### 표준 입출력 스트림

* `stdin`, `stdout`, `stderr`: 각각 표준 입력, 표준 출력, 표준 오류를 나타내는 `FILE` 포인터이다. C 프로그램이 실행되면 자동적으로 열리고 프로그램이 종료될 때 자동으로 닫힌다.
* **각 스트림이 가리키는 장치**: `stdin`은 키보드, `stdout`은 모니터, `stderr`은 모니터를 가리킨다.

#### 파일 닫기

* 파일을 열어서 사용한 후에는 파일을 닫아야 한다.
* **함수 `fclose()`**: `int fclose(FILE *fp);` 함수는 `fp`가 가리키는 파일을 닫는다. 성공하면 0, 오류일 때는 -1을 반환한다.

---

### ☑️ 12.6 파일 입출력 함수

#### 파일 입출력 함수

| 표준 입출력 함수 | 파일 입출력 함수 | 기능 |
| :--------------- | :--------------- | :--- |
| `getchar()`      | `fgetc(), getc()` | 문자단위로 입력하는 함수 |
| `putchar()`      | `fputc(), putc()` | 문자단위로 출력하는 함수 |
| `gets()`         | `fgets()`        | 문자열을 입력하는 함수 |
| `puts()`         | `fputs()`        | 문자열을 출력하는 함수 |
| `scanf()`        | `fscanf()`       | 자료형에 따라 자료를 입력하는 함수 |
| `printf()`       | `fprintf()`      | 자료형에 따라 자료를 출력하는 함수 |

#### 문자 단위 입출력

* **`fgetc()` 함수와 `fputc()` 함수**: 파일에 문자 단위 입출력을 할 수 있다.
* **`int fgetc(FILE *fp);`**: `fgetc` 함수는 `fp`가 지정한 파일에서 한 문자를 읽어서 리턴하며, 파일 끝에 도달했을 경우에는 `EOF(-1)`를 리턴한다.
* **`int fputc(int c, FILE *fp);`**: `fputc` 함수는 파일에 한 문자씩 출력하며, 리턴값으로 출력하는 문자를 리턴하고 출력시 오류가 발생하면 `EOF(-1)`를 리턴한다.

---

### ☑️ 12.7 명령어 구현

#### `cat.c`

* **기능**: 텍스트 파일 내용을 표준출력에 프린트한다.
* **주요 로직**: 명령줄 인수가 없으면 표준 입력을 사용하고, 그렇지 않으면 파일을 읽기 전용으로 열어 문자 단위로 읽어서 표준 출력에 출력한다.

#### `copy.c`

* **기능**: 파일 복사 프로그램이다.
* **주요 로직**: 명령줄 인수가 3개가 아니면 사용법 오류를 출력하고 종료한다. 첫 번째 파일을 읽기 전용으로, 두 번째 파일을 쓰기 전용으로 열어 문자 단위로 읽고 써서 복사한다.

---

### ☑️ 12.8 줄단위 입출력

#### 줄 단위 입출력

* **파일로 한 줄씩 읽기**: `char* fgets(char *s, int n, FILE *fp);` 함수는 파일로부터 한 줄을 읽어서 문자열 포인터 `s`에 저장하고 `s`를 리턴한다.
* **파일에 한 줄씩 쓰기**: `int fputs(const char *s, FILE *fp);` 함수는 문자열 `s`를 `fp`가 나타내는 파일에 출력하며, 성공하면 출력한 바이트 수를, 실패하면 `EOF` 값을 리턴한다.

#### `line.c`

* **기능**: 텍스트 파일에 줄 번호를 붙여 프린트한다.
* **주요 로직**: 파일을 읽기 모드로 열고, `fgets`를 사용하여 한 줄씩 읽어 줄 번호와 함께 표준 출력에 프린트한다.

---
